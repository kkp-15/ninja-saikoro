<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>サイコロの術 🎲</title>

<!-- ✅ SEO -->
<meta name="description" content="クイック / 決める / RPG の3モード。色付きで見やすい特大サイコロ、スワイプで再ロール。スマホに最適化されたシンプルUI。" />
<meta name="keywords" content="サイコロ, ダイス, 乱数, ボードゲーム, TRPG, 決める, 抽選, 無料, スマホ, Webアプリ" />

<!-- ✅ OGP / Twitter -->
<meta property="og:title" content="サイコロの術 🎲" />
<meta property="og:description" content="クイック / 決める / RPG の3モード。色付きで見やすい特大サイコロ、スワイプで再ロール。スマホに最適化されたシンプルUI。" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://dice.kkpwebninja.com/" />
<meta property="og:image" content="https://dice.kkpwebninja.com/dice.png" />
<meta property="og:site_name" content="web忍者ツール" />
<meta property="og:locale" content="ja_JP" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@kkp_webninja" />

<!-- ✅ Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)}
  gtag('js', new Date());
  gtag('config', 'G-2LM85GJN0L');
</script>

<style>
  :root {
    --bg:#f7f7fb; --fg:#111827; --muted:#6b7280;
    --die:#ffffff; --border:#e5e7eb; --radius:18px;
    --btn1:#6366f1; --btn2:#06b6d4;
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg:#0b0d12; --fg:#e5e7eb; --muted:#9aa2b2;
      --die:#15192d; --border:#2a2f45;
      --btn1:#7c7bff; --btn2:#3bd6e9;
    }
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",sans-serif;
    background:
      radial-gradient(1000px 700px at 80% -10%, rgba(99,102,241,.10), transparent 50%),
      radial-gradient(900px 600px at -10% 40%, rgba(6,182,212,.10), transparent 55%),
      var(--bg);
    color: var(--fg);
    padding: 16px;
    line-height: 1.45;
  }
  h1 { margin: 0 0 8px; font-size: clamp(18px,4.5dvw,28px); font-weight: 800; }
  .sub { color: var(--muted); margin-bottom: 14px; font-size: .95rem }

  .chips { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 14px; }
  .chip {
    border: 1px solid var(--border); border-radius: 999px; padding: 10px 14px;
    background: transparent; color: var(--fg); font-weight: 700; cursor: pointer;
  }
  .chip.active {
    color: #fff; border-color: transparent;
    background: linear-gradient(135deg, var(--btn1), var(--btn2));
  }

  .primary {
    width: 100%; border: none; border-radius: 14px; padding: 16px 18px;
    font-weight: 800; font-size: clamp(16px,3.8dvw,20px); color: #fff;
    background: linear-gradient(135deg, var(--btn1), var(--btn2));
    box-shadow: 0 10px 24px rgba(0,0,0,.12); cursor: pointer;
  }

  .opts { display: flex; align-items: center; gap: 12px; margin-bottom: 6px; justify-content: space-between; }
  .left-opts { display: flex; align-items: center; gap: 12px; }
  .tog { display: inline-flex; align-items: center; gap: 8px; border: 1px solid var(--border); border-radius: 10px; padding: 8px 12px; }
  .tog input { accent-color: #3b82f6; }
  #helpBtn {
    border: 1px solid var(--border); border-radius: 999px; padding: 6px 10px;
    background: transparent; color: var(--muted); cursor: pointer;
  }

  /* サイコロサイズ可変（大画面対応） */
  .dice-area{
    margin-top:14px;
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--die-min), 1fr));
    gap: var(--gap);
  }
  .dice-area.one{
    --die-min: clamp(180px, 28vw, 360px);
    --pip: 42%;
    --gap: 18px;
  }
  .dice-area.few{
    --die-min: clamp(160px, 22vw, 300px);
    --pip: 38%;
    --gap: 16px;
  }
  .dice-area.many{
    --die-min: clamp(130px, 18vw, 220px);
    --pip: 34%;
    --gap: 14px;
  }

  .die {
    aspect-ratio: 1/1; border-radius: var(--radius); background: var(--die);
    border: 1px solid var(--border); display: grid; place-items: center; position: relative;
    --h: 210;
    background:
      radial-gradient(60% 55% at 50% 35%, hsl(var(--h) 100% 94%) 0%, transparent 65%),
      var(--die);
    box-shadow:
      0 6px 18px hsl(var(--h) 80% 40% / .10),
      inset 0 0 0 1px hsl(var(--h) 60% 75% / .40);
  }
  @media (prefers-color-scheme: dark) {
    .die {
      background:
        radial-gradient(60% 55% at 50% 35%, hsl(var(--h) 80% 20% / .55) 0%, transparent 65%),
        var(--die);
      box-shadow:
        0 8px 20px hsl(var(--h) 80% 30% / .25),
        inset 0 0 0 1px hsl(var(--h) 70% 55% / .30);
    }
  }

  .face {
    position: absolute; inset: 8%; border-radius: 14px;
    display: grid; grid-template-columns: repeat(3,1fr); grid-template-rows: repeat(3,1fr);
    place-items: center; gap: 3%;
  }

  .pip {
    width: var(--pip); aspect-ratio: 1/1; border-radius: 50%;
    background: #111827; box-shadow: inset 0 -1px 1px rgba(255,255,255,.35);
  }
  @media (prefers-color-scheme: dark) {
    .pip { background: #ffffff; box-shadow: none; }
  }

  /* 結果の文字サイズアップ */
  .result {
    margin-top: 12px;
    font-weight: 800;
    font-size: clamp(20px, 4.5dvw, 32px);
    display: inline-block;
    padding: 8px 14px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--btn1), var(--btn2));
    color: #fff;
  }
  .hint {
    color: var(--muted);
    font-size: clamp(15px, 3dvw, 20px);
    margin-top: 8px;
    line-height: 1.4;
  }

  .decide-wrap { display: flex; gap: 10px; align-items: center; margin: 6px 0 12px; }
  .num-input {
    flex: 1; border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px;
    font-weight: 700; font-size: 1rem; background: var(--die); color: var(--fg);
  }
  .num-input:invalid { outline: 2px solid #ef4444; }

  .dice-types { display: flex; flex-wrap: wrap; gap: 8px; margin: 6px 0 12px; }

  #helpBackdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.25); }
  #helpSheet {
    display: none; position: fixed; left: 0; right: 0; bottom: 0;
    background: var(--die); color: var(--fg);
    border-top-left-radius: 16px; border-top-right-radius: 16px;
    box-shadow: 0 -12px 30px rgba(0,0,0,.18);
    padding: 16px; max-height: 60vh; overflow: auto;
  }
  #helpBackdrop.show { display: block; animation: fade .15s ease-out; }
  #helpSheet.show { display: block; animation: rise .2s ease-out; }
  @keyframes fade { from{opacity:0} to{opacity:1} }
  @keyframes rise { from{transform:translateY(16px); opacity:.8} to{transform:translateY(0); opacity:1} }

  #toast {
    display: none; position: fixed; left: 50%; transform: translateX(-50%);
    bottom: 84px; background: #111827; color: #fff;
    padding: 10px 14px; border-radius: 12px; font-size: .9rem;
  }

  #footer {
    margin-top: 22px; color: var(--muted); font-size: .9rem; text-align: center;
  }
  #footer a {
    color: inherit; text-decoration: underline;
  }
</style>
</head>
<body>
<!-- ここから下はあなたの現行HTML本体＆JSをそのまま -->
  <h1>サイコロの術 🎲</h1>
  <div class="sub">クイック / 決める / RPG。必要なときに、1タップ。</div>

  <div class="chips" id="modeChips">
    <button class="chip active" data-mode="quick">クイック</button>
    <button class="chip" data-mode="decide">決める</button>
    <button class="chip" data-mode="rpg">RPG</button>
  </div>

  <div class="opts">
    <div class="left-opts">
      <label class="tog"><input type="checkbox" id="vib" checked> バイブ</label>
      <div class="hint">※下→上スワイプで再ロール</div>
    </div>
    <button id="helpBtn" aria-label="使い方">？</button>
  </div>

  <!-- クイックモード -->
  <div id="quick" class="mode">
    <div class="chips" id="countChips">
      <button class="chip" data-n="1">1個</button>
      <button class="chip active" data-n="2">2個</button>
      <button class="chip" data-n="3">3個</button>
      <button class="chip" data-n="4">4個</button>
      <button class="chip" data-n="5">5個</button>
      <button class="chip" data-n="6">6個</button>
    </div>
    <button id="rollQuick" class="primary">振る！</button>
    <div id="diceArea" class="dice-area"></div>
    <div id="sumQuick" class="result" style="display:none"></div>
    <div id="detailQuick" class="hint" style="display:none"></div>
  </div>

  <!-- 決めるモード -->
  <div id="decide" class="mode" style="display:none">
    <div class="decide-wrap">
      <label for="maxN" class="sub" style="min-width:4.5em">最大N</label>
      <input id="maxN" class="num-input" type="number" inputmode="numeric" min="2" max="999999" value="6" />
    </div>
    <button id="rollDecide" class="primary">振る！</button>
    <div id="sumDecide" class="result" style="display:none"></div>
  </div>

  <!-- RPGモード -->
  <div id="rpg" class="mode" style="display:none">
    <div class="dice-types" id="typeChips">
      <button class="chip active" data-sides="6">D6</button>
      <button class="chip" data-sides="8">D8</button>
      <button class="chip" data-sides="10">D10</button>
      <button class="chip" data-sides="12">D12</button>
      <button class="chip" data-sides="20">D20</button>
    </div>
    <button id="rollRPG" class="primary">振る！</button>
    <div id="sumRPG" class="result" style="display:none"></div>
  </div>

  <!-- ヘルプ -->
  <div id="helpBackdrop"></div>
  <div id="helpSheet" role="dialog" aria-modal="true" aria-label="使い方">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px">
      <strong>使い方</strong>
      <button id="helpClose" class="chip" style="padding:6px 10px">閉じる</button>
    </div>
    <ul style="margin:0; padding-left:1.2em; line-height:1.6">
      <li><b>クイック</b>：個数を選んで「振る！」→ 合計と内訳を表示</li>
      <li><b>決める</b>：1〜Nでランダム整数（順番決め・お題決めに）</li>
      <li><b>RPG</b>：D6/D8/D10/D12/D20から1個をロール</li>
      <li><b>再ロール</b>：画面を下→上へスワイプ</li>
      <li><b>静かな場</b>：バイブだけON/OFFできます</li>
    </ul>
  </div>

  <div id="toast">ヒント：下から上へスワイプで再ロール</div>

  <details style="margin-top:24px; font-size:.95rem; line-height:1.6">
    <summary style="cursor:pointer; font-weight:bold; color:var(--muted)">このアプリについて</summary>
    <p>サイコロの術 🎲 は、スマホやPCで手軽にサイコロを振れる無料Webアプリです。クイックモードでは1〜6個のサイコロを同時に振り、合計と内訳を表示します。決めるモードでは1〜任意の数字までの乱数を生成し、順番決めやお題決めに便利です。RPGモードではD6・D8・D10・D12・D20を1つ振ることができます。ボードゲーム、TRPG、イベント、授業や確率実験など幅広い用途に対応します。</p>
  </details>

  <div id="footer">
    X <a href="https://x.com/kkp_webninja" target="_blank">@kkp_webninja</a> ・
    🏯 <a href="https://kkpwebninja.com" target="_blank">本丸</a>
  </div>

  <script>
  const $ = s => document.querySelector(s);
  const $$ = s => [...document.querySelectorAll(s)];
  let mode = 'quick';
  let diceCount = 2;
  let rpgSides = 6;
  const HUES = [355, 25, 50, 200, 150, 280];

  function pipLayout(n) {
    const one = [0,0,0, 0,1,0, 0,0,0];
    const two = [1,0,0, 0,0,0, 0,0,1];
    const three = [1,0,0, 0,1,0, 0,0,1];
    const four = [1,0,1, 0,0,0, 1,0,1];
    const five = [1,0,1, 0,1,0, 1,0,1];
    const six = [1,0,1, 1,0,1, 1,0,1];
    return [one,two,three,four,five,six][n-1];
  }

  function createDie(face=1){
    const d = document.createElement('div');
    d.className = 'die';
    d.style.setProperty('--h', HUES[face-1] ?? 210);
    const f = document.createElement('div');
    f.className = 'face';
    const layout = pipLayout(face);
    for(let i=0;i<9;i++){
      if(layout[i]){
        const p = document.createElement('div');
        p.className = 'pip';
        f.appendChild(p);
      } else {
        f.appendChild(document.createElement('div'));
      }
    }
    d.appendChild(f);
    return d;
  }

  const diceArea = $('#diceArea');
  function applyGridClass(n){
    diceArea.classList.remove('one','few','many');
    if(n===1) diceArea.classList.add('one');
    else if(n<=3) diceArea.classList.add('few');
    else diceArea.classList.add('many');
  }

  function buzz(){
    if($('#vib').checked && navigator.vibrate) navigator.vibrate(18);
  }

  function rollQuick(){
    applyGridClass(diceCount);
    diceArea.innerHTML = '';
    const faces = [];
    let sum = 0;
    for(let i=0;i<diceCount;i++){
      const r = Math.floor(Math.random()*6) + 1;
      faces.push(r);
      sum += r;
      diceArea.appendChild(createDie(r));
    }
    $('#sumQuick').textContent = `合計 ${sum}`;
    $('#sumQuick').style.display = 'inline-block';
    $('#detailQuick').textContent = `内訳: ${faces.join(' / ')}`;
    $('#detailQuick').style.display = 'block';
    buzz();
  }

  function rollDecide(){
    const max = parseInt($('#maxN').value, 10);
    if(!Number.isFinite(max) || max < 2 || max > 999999){
      $('#maxN').focus();
      $('#maxN').reportValidity?.();
      return;
    }
    const val = Math.floor(Math.random()*max) + 1;
    $('#sumDecide').textContent = String(val);
    $('#sumDecide').style.display = 'inline-block';
    buzz();
  }

  function rollRPG(){
    const val = Math.floor(Math.random()*rpgSides) + 1;
    $('#sumRPG').textContent = `D${rpgSides} → ${val}`;
    $('#sumRPG').style.display = 'inline-block';
    buzz();
  }

  function switchMode(next){
    if(mode === next) return;
    mode = next;
    $$('.chip[data-mode]').forEach(c => c.classList.toggle('active', c.dataset.mode===next));
    $('#quick').style.display  = (next==='quick')  ? 'block' : 'none';
    $('#decide').style.display = (next==='decide') ? 'block' : 'none';
    $('#rpg').style.display    = (next==='rpg')    ? 'block' : 'none';
    if(next==='quick'){ $('#sumQuick').style.display='none'; $('#detailQuick').style.display='none'; diceArea.innerHTML=''; }
    if(next==='decide'){ $('#sumDecide').style.display='none'; }
    if(next==='rpg'){ $('#sumRPG').style.display='none'; }
  }

  $('#modeChips').addEventListener('click', e=>{
    const b = e.target.closest('.chip'); if(!b) return;
    switchMode(b.dataset.mode);
  });
  $('#countChips').addEventListener('click', e=>{
    const b = e.target.closest('.chip'); if(!b) return;
    $$('#countChips .chip').forEach(c=>c.classList.remove('active'));
    b.classList.add('active');
    diceCount = parseInt(b.dataset.n,10);
    applyGridClass(diceCount);
  });
  $('#typeChips').addEventListener('click', e=>{
    const b = e.target.closest('.chip'); if(!b) return;
    $$('#typeChips .chip').forEach(c=>c.classList.remove('active'));
    b.classList.add('active');
    rpgSides = parseInt(b.dataset.sides,10);
  });
  $('#rollQuick').addEventListener('click', rollQuick);
  $('#rollDecide').addEventListener('click', rollDecide);
  $('#rollRPG').addEventListener('click', rollRPG);

  let tStartY = null;
  window.addEventListener('touchstart', e=>{
    tStartY = e.changedTouches?.[0]?.clientY ?? null;
  },{passive:true});
  window.addEventListener('touchend', e=>{
    const endY = e.changedTouches?.[0]?.clientY ?? null;
    if(tStartY==null || endY==null) return;
    const dy = endY - tStartY;
    if(dy < -40){
      if(mode==='quick') rollQuick();
      else if(mode==='decide') rollDecide();
      else if(mode==='rpg') rollRPG();
    }
    tStartY = null;
  },{passive:true});

  const helpBtn = $('#helpBtn');
  const helpClose = $('#helpClose');
  const helpSheet = $('#helpSheet');
  const helpBackdrop = $('#helpBackdrop');

  function openHelp(){ helpBackdrop.classList.add('show'); helpSheet.classList.add('show'); }
  function closeHelp(){ helpBackdrop.classList.remove('show'); helpSheet.classList.remove('show'); }

  helpBtn.addEventListener('click', openHelp);
  helpClose.addEventListener('click', closeHelp);
  helpBackdrop.addEventListener('click', closeHelp);

  (function(){
    const KEY='dice.help.toast.v1';
    if(!localStorage.getItem(KEY)){
      const toast = document.getElementById('toast');
      toast.style.display='block';
      setTimeout(()=> toast.style.display='none', 3000);
      localStorage.setItem(KEY,'1');
    }
  })();

  switchMode('quick');
  applyGridClass(diceCount);
  </script>
</body>
</html>
