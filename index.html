<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ã‚µã‚¤ã‚³ãƒ­ã®è¡“ ğŸ² - è¶…æ°—æŒã¡ã„ã„ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«</title>

<!-- SEO -->
<meta name="description" content="ã‚µã‚¯ãƒƒã¨è¶…æ°—æŒã¡ã„ã„ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«ã€‚ã‚µã‚¤ã‚³ãƒ­å€‹æ•°ã‚’ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—é¸æŠâ†’è»¢ãŒã‚‹ã‚¢ãƒ‹ãƒ¡â†’åˆè¨ˆãƒ»å†…è¨³è¡¨ç¤ºã€‚å±¥æ­´ä¿å­˜ãƒ»åŠ¹æœéŸ³ãƒ»ãƒã‚¤ãƒ–å¯¾å¿œãƒ»ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰è‡ªå‹•ã€‚" />
<meta name="keywords" content="ã‚µã‚¤ã‚³ãƒ­, ãƒ€ã‚¤ã‚¹, ä¹±æ•°, ãƒ­ãƒ¼ãƒ«, tabletop, TRPG, ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ , ç¢ºç‡, ä¾¿åˆ©ãƒ„ãƒ¼ãƒ«" />

<!-- OGP -->
<meta property="og:title" content="ã‚µã‚¤ã‚³ãƒ­ã®è¡“ ğŸ²" />
<meta property="og:description" content="ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§æ°—æŒã¡ã„ã„ï¼è»¢ãŒã‚‹ã‚¢ãƒ‹ãƒ¡ï¼‹åˆè¨ˆãƒ»å†…è¨³ï¼‹å±¥æ­´ä¿å­˜ã®é«˜UIãƒ€ã‚¤ã‚¹ã€‚" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://dice.kkpwebninja.com/" />
<meta property="og:image" content="https://dice.kkpwebninja.com/card.png" />
<meta name="twitter:card" content="summary_large_image" />

<!-- PWAã«æ‹¡å¼µã™ã‚‹å ´åˆã¯å¾Œã§manifestã¨service workerã‚’è¿½åŠ ã™ã‚Œã°OK -->

<style>
  :root{
    --bg:#f7f7fb;
    --fg:#0f1222;
    --muted:#6b7280;
    --brand:#635bff;
    --brand-2:#00c2ff;
    --card:#ffffff;
    --border:rgba(0,0,0,.06);
    --shadow: 0 10px 30px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.06);
    --radius:18px;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0b0d12;
      --fg:#e8ebff;
      --muted:#9aa2b2;
      --brand:#8d85ff;
      --brand-2:#41d9ff;
      --card:#111423;
      --border:rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.35);
    }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", sans-serif;
    background: radial-gradient(1200px 800px at 70% -10%, rgba(99,91,255,.12), transparent 60%),
                radial-gradient(1000px 700px at -10% 30%, rgba(0,194,255,.10), transparent 60%),
                var(--bg);
    color:var(--fg); padding: clamp(12px, 2dvw, 24px);
  }
  header{
    display:flex; align-items:center; justify-content:space-between; gap:12px; margin:0 auto 14px;
    max-width: 960px;
  }
  .title{
    display:flex; align-items:center; gap:12px;
  }
  .logo{
    width:42px; height:42px; border-radius:12px; background:
      radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.2) 40%, transparent 60%),
      linear-gradient(135deg, var(--brand), var(--brand-2));
    box-shadow: var(--shadow);
    display:grid; place-items:center; font-size:22px;
    user-select:none;
  }
  h1{font-size: clamp(18px, 4dvw, 28px); margin:0;}
  .sub{color:var(--muted); font-size: .92rem; margin-top:2px}

  .wrap{max-width:960px; margin:0 auto; display:grid; gap:16px}
  .card{
    background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    padding: clamp(12px, 2dvw, 18px); box-shadow: var(--shadow);
  }

  /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
  .controls{display:grid; gap:12px}
  .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
  .chips{display:flex; flex-wrap:wrap; gap:8px}
  .chip{
    padding:10px 14px; border-radius:999px; border:1px solid var(--border);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.03));
    backdrop-filter: blur(4px);
    cursor:pointer; user-select:none; font-weight:600; font-size:.98rem;
    transition:.2s transform, .2s background; 
  }
  .chip.active{outline:2px solid var(--brand); transform: translateY(-1px)}
  .select{
    padding:10px 12px; border-radius:12px; border:1px solid var(--border);
    background:var(--card); color:var(--fg); font-weight:600;
  }
  .tog{
    display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none;
    padding:8px 12px; border-radius:12px; border:1px solid var(--border);
  }
  .tog input{accent-color: var(--brand)}
  .grow{flex:1}

  /* ã‚µã‚¤ã‚³ãƒ­ç›¤é¢ */
  .dice-area{
    display:grid; grid-template-columns: repeat(auto-fit, minmax(82px, 1fr));
    gap:12px; align-items:stretch;
  }
  .die{
    aspect-ratio:1/1; border-radius:18px; position:relative; 
    background: linear-gradient(160deg, #fff, #f1f3ff);
    border:1px solid var(--border); box-shadow: var(--shadow);
    display:grid; place-items:center;
    transform-style: preserve-3d; 
  }
  @media (prefers-color-scheme: dark){
    .die{ background: linear-gradient(160deg, #1a1f35, #12162a);}
    .pip{background: #fff}
  }
  .die.roll{ animation: spin .6s cubic-bezier(.2,.7,.2,1) }
  @keyframes spin {
    0%{ transform: rotateX(0) rotateY(0) }
    50%{ transform: rotateX(220deg) rotateY(140deg) }
    100%{ transform: rotateX(360deg) rotateY(360deg) }
  }
  .face{
    position:absolute; inset:8%; border-radius:14px;
    display:grid; grid-template-columns: repeat(3,1fr); grid-template-rows: repeat(3,1fr);
    place-items:center; gap:6%;
  }
  .pip{
    width:20%; aspect-ratio:1/1; border-radius:50%;
    background:#1b2037; box-shadow: inset 0 -1px 1px rgba(255,255,255,.4);
  }

  /* çµæœ */
  .result{
    display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:space-between;
    padding:10px 12px; border-radius:14px; border:1px dashed var(--border);
    background: linear-gradient(180deg, rgba(99,91,255,.08), transparent);
  }
  .nums{color:var(--muted); font-size:.95rem}
  .sum{font-weight:800; font-size: clamp(18px, 3.5dvw, 26px)}

  /* ãƒœã‚¿ãƒ³ */
  .primary{
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
    width:100%; padding:16px 18px; font-size: clamp(16px, 3.8dvw, 20px); font-weight:800;
    color:#fff; background: linear-gradient(135deg, var(--brand), var(--brand-2));
    border:none; border-radius:16px; cursor:pointer; box-shadow: var(--shadow);
    transition: transform .06s ease;
  }
  .primary:active{ transform: translateY(1px) scale(.995) }

  .ghost{ border:1px solid var(--border); background:transparent; color:var(--fg); border-radius:12px; padding:10px 14px; cursor:pointer}
  .toolbar{display:flex; gap:10px; flex-wrap:wrap}

  /* å±¥æ­´ */
  .history-list{display:grid; gap:8px; max-height:260px; overflow:auto; padding-right:4px}
  .hist{
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    border:1px solid var(--border); border-radius:12px; padding:8px 10px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.02));
  }
  .hist .meta{color:var(--muted); font-size:.85rem}
  .faces{display:flex; gap:4px; flex-wrap:wrap}
  .pill{
    border:1px solid var(--border); border-radius:999px; padding:2px 8px; font-weight:700; font-size:.9rem;
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.04));
  }

  /* ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆã„ã¤ã‚‚ã®ï¼‰ */
  #footer{
    text-align:center; color:var(--muted); margin-top: 8px;
  }
  #footer a{color:inherit; text-decoration: underline}
</style>

<!-- Google Analytics: ã„ã¤ã‚‚ã®ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)}
  gtag('js', new Date());
  gtag('config', 'G-2LM85GJN0L');
</script>
</head>
<body>
  <header>
    <div class="title">
      <div class="logo">ğŸ²</div>
      <div>
        <h1>ã‚µã‚¤ã‚³ãƒ­ã®è¡“</h1>
        <div class="sub">ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ãƒ»è¶…æ°—æŒã¡ã„ã„ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«ã€‚å±¥æ­´ä¿å­˜ï¼†ã‚·ã‚§ã‚¢å¯¾å¿œã€‚</div>
      </div>
    </div>
    <div class="toolbar">
      <button id="shareBtn" class="ghost" title="çµæœã‚’Xã§ã‚·ã‚§ã‚¢">å…±æœ‰</button>
      <button id="clearBtn" class="ghost" title="å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤">å±¥æ­´ã‚¯ãƒªã‚¢</button>
    </div>
  </header>

  <main class="wrap">
    <section class="card controls">
      <div class="row">
        <strong>ã‚µã‚¤ã‚³ãƒ­å€‹æ•°</strong>
        <div class="chips" id="chips">
          <!-- ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ãƒ—ãƒªã‚»ãƒƒãƒˆ -->
          <button class="chip" data-n="1">1å€‹</button>
          <button class="chip active" data-n="2">2å€‹</button>
          <button class="chip" data-n="3">3å€‹</button>
          <button class="chip" data-n="4">4å€‹</button>
          <button class="chip" data-n="5">5å€‹</button>
          <button class="chip" data-n="6">6å€‹</button>
        </div>
        <div class="grow"></div>
        <label class="tog" title="åŠ¹æœéŸ³ã®å†ç”Ÿã‚’åˆ‡ã‚Šæ›¿ãˆ">
          <input type="checkbox" id="snd" checked> åŠ¹æœéŸ³
        </label>
        <label class="tog" title="ç«¯æœ«ã®ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨">
          <input type="checkbox" id="vib" checked> ãƒã‚¤ãƒ–
        </label>
      </div>

      <button id="rollBtn" class="primary">æŒ¯ã‚‹ï¼</button>

      <div id="diceArea" class="dice-area" aria-live="polite"></div>

      <div class="result" id="resultBar" style="display:none">
        <div class="nums" id="nums"></div>
        <div class="sum" id="sum"></div>
      </div>
    </section>

    <section class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px">
        <strong>å±¥æ­´ï¼ˆæœ€æ–°10ä»¶ï¼‰</strong>
        <small class="sub">ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¾ã™</small>
      </div>
      <div id="history" class="history-list"></div>
    </section>

    <section class="card" id="links">
      <div class="toolbar">
        <a class="ghost" href="https://bingomachine.kkpwebninja.com/" target="_blank" rel="noopener">â†’ ãƒ“ãƒ³ã‚´ã®è¡“ï¼ˆæŠ½é¸æ©Ÿï¼‰ã¸</a>
      </div>
    </section>

    <div id="footer">
      X <a href="https://x.com/kkp_webninja" target="_blank">@kkp_webninja</a> <br>
      ğŸ¯ <a href="https://kkpwebninja.com" target="_blank">webå¿è€…ã®æœ¬ä¸¸</a><br>
    </div>
  </main>

<script>
/* ========= ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ========= */
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
const diceArea = $('#diceArea');
const sumEl = $('#sum');
const numsEl = $('#nums');
const resultBar = $('#resultBar');
const chips = $('#chips');
const shareBtn = $('#shareBtn');
const clearBtn = $('#clearBtn');
const rollBtn = $('#rollBtn');
const snd = $('#snd'); const vib = $('#vib');

let diceCount = 2;
let lastRoll = null;

/* ========= åŠ¹æœéŸ³ï¼ˆWebAudioï¼‰ ========= */
let audioCtx;
function playRollSound(){
  if(!snd.checked) return;
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(240, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.3);
    gain.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.3, audioCtx.currentTime + 0.02);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.32);
    osc.connect(gain).connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.33);
  }catch(e){}
}
function buzz(){
  if(vib.checked && navigator.vibrate) navigator.vibrate(18);
}

/* ========= ã‚µã‚¤ã‚³ãƒ­DOMç”Ÿæˆ ========= */
function createDie(face=1){
  const d = document.createElement('div');
  d.className = 'die roll';
  const f = document.createElement('div');
  f.className = 'face';
  const layout = pipLayout(face);
  for(let i=0;i<9;i++){
    if(layout[i]){
      const p = document.createElement('div');
      p.className = 'pip';
      f.appendChild(p);
    }else{
      const s = document.createElement('div'); f.appendChild(s);
    }
  }
  d.appendChild(f);
  // ã‚¢ãƒ‹ãƒ¡çµ‚äº†å¾Œã«ã‚¯ãƒ©ã‚¹ã‚’å¤–ã™
  d.addEventListener('animationend', ()=> d.classList.remove('roll'), {once:true});
  return d;
}
// 1ã€œ6ã®é…ç½®ï¼ˆ3x3ã‚°ãƒªãƒƒãƒ‰ï¼‰
function pipLayout(n){
  // 0:ç©º, 1:ãƒ”ãƒƒãƒ—
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: 0 1 2 / 3 4 5 / 6 7 8
  const center = [0,0,0,0,1,0,0,0,0];
  const one =   [0,0,0,0,1,0,0,0,0];
  const two =   [1,0,0,0,0,0,0,0,1];
  const three = [1,0,0,0,1,0,0,0,1];
  const four =  [1,0,1,0,0,0,1,0,1];
  const five =  [1,0,1,0,1,0,1,0,1];
  const six =   [1,0,1,1,0,1,1,0,1];
  return [one, two, three, four, five, six][n-1];
}

/* ========= ãƒ­ãƒ¼ãƒ«å‡¦ç† ========= */
function roll(){
  playRollSound();
  buzz();

  diceArea.innerHTML = '';
  const faces = [];
  let sum = 0;
  for(let i=0;i<diceCount;i++){
    const r = Math.floor(Math.random()*6)+1;
    faces.push(r); sum += r;
    diceArea.appendChild(createDie(r));
  }
  lastRoll = {faces, sum, ts: Date.now(), n:diceCount};
  // è¡¨ç¤º
  sumEl.textContent = `åˆè¨ˆ ${sum}`;
  numsEl.textContent = `å†…è¨³: ${faces.join(' / ')}`;
  resultBar.style.display = 'flex';

  saveHistory(lastRoll);
  renderHistory();
}

/* ========= å±¥æ­´ï¼ˆlocalStorageï¼‰ ========= */
const KEY = 'dice.history.v1';
function loadHistory(){
  try{ return JSON.parse(localStorage.getItem(KEY) || '[]'); }
  catch(e){ return []; }
}
function saveHistory(entry){
  const arr = loadHistory();
  arr.unshift(entry);
  if(arr.length>10) arr.length = 10;
  localStorage.setItem(KEY, JSON.stringify(arr));
}
function clearHistory(){
  localStorage.removeItem(KEY);
  renderHistory();
}
function renderHistory(){
  const arr = loadHistory();
  const wrap = $('#history');
  wrap.innerHTML = '';
  if(arr.length===0){
    wrap.innerHTML = '<div class="sub">ã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŒ¯ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼</div>';
    return;
  }
  arr.forEach(item=>{
    const row = document.createElement('div'); row.className='hist';
    const left = document.createElement('div');
    const dt = new Date(item.ts);
    left.innerHTML = `<div class="meta">${dt.toLocaleString()}</div>
                      <div class="faces">${item.faces.map(f=>`<span class="pill">${f}</span>`).join('')}</div>`;
    const right = document.createElement('div');
    right.innerHTML = `<strong>åˆè¨ˆ ${item.sum}</strong> / <span class="meta">${item.n}å€‹</span>`;
    row.append(left,right);
    wrap.appendChild(row);
  });
}

/* ========= ã‚·ã‚§ã‚¢ ========= */
function shareToX(){
  const h = loadHistory()[0];
  if(!h){ alert('ã¾ã æŒ¯ã£ã¦ã„ã¾ã›ã‚“'); return; }
  const text = `ã‚µã‚¤ã‚³ãƒ­ã®è¡“ğŸ²\n${h.n}å€‹ãƒ­ãƒ¼ãƒ« â†’ åˆè¨ˆ ${h.sum}\nå†…è¨³: ${h.faces.join(' / ')}\n#ã‚µã‚¤ã‚³ãƒ­ #ãƒ€ã‚¤ã‚¹\n\nhttps://dice.kkpwebninja.com/?v=2\n\n@kkp_webninja`;
  const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
  window.open(url, '_blank');
}

/* ========= ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ² ========= */
chips.addEventListener('click', e=>{
  const b = e.target.closest('.chip'); if(!b) return;
  $$('.chip').forEach(c=>c.classList.remove('active'));
  b.classList.add('active');
  diceCount = parseInt(b.dataset.n, 10);
});
rollBtn.addEventListener('click', roll);
shareBtn.addEventListener('click', shareToX);
clearBtn.addEventListener('click', ()=>{
  if(confirm('å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) clearHistory();
});

/* åˆæœŸæç”» */
renderHistory();
</script>
</body>
</html>
